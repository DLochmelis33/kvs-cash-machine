\hypertarget{classShard}{}\doxysection{Shard Class Reference}
\label{classShard}\index{Shard@{Shard}}


A single part of \mbox{\hyperlink{classKVS}{KVS}} after sharding.  




{\ttfamily \#include $<$Shard.\+h$>$}



Collaboration diagram for Shard\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=550pt]{classShard__coll__graph}
\end{center}
\end{figure}
\doxysubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{classShard_ad1d1e143159f59129d23f642c796477f}{Shard}} ()=delete
\item 
std\+::pair$<$ \mbox{\hyperlink{structEntry}{Entry}}, std\+::optional$<$ \mbox{\hyperlink{classValue}{Value}} $>$ $>$ \mbox{\hyperlink{classShard_ae06a68baa373b1dc5d006c50ffc3f935}{read\+Value}} (\mbox{\hyperlink{classKey}{Key}} key) const
\begin{DoxyCompactList}\small\item\em Read a value from this shard. \end{DoxyCompactList}\item 
\mbox{\hyperlink{structEntry}{Entry}} \mbox{\hyperlink{classShard_a1d553b3945c59a9eea2404c170debb77}{write\+Value}} (\mbox{\hyperlink{classKey}{Key}} key, const \mbox{\hyperlink{classValue}{Value}} \&value)
\begin{DoxyCompactList}\small\item\em Write a value to this shard. \end{DoxyCompactList}\item 
\mbox{\hyperlink{structEntry}{Entry}} \mbox{\hyperlink{classShard_ac1f0ae87249f0d74361de03226940a14}{remove\+Entry}} (\mbox{\hyperlink{classKey}{Key}} key)
\begin{DoxyCompactList}\small\item\em Remove a value from this shard. \end{DoxyCompactList}\item 
\mbox{\hyperlink{classValue}{Value}} \mbox{\hyperlink{classShard_a0c5ba849d919ae276ff2b2985e582e1a}{read\+Value\+Directly}} (\mbox{\hyperlink{classPtr}{Ptr}} ptr) const
\begin{DoxyCompactList}\small\item\em Read a value directly from disk storage. Used when \mbox{\hyperlink{classCacheMap}{Cache\+Map}} entry is hit. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classShard_a0037fc14121a68f2320549d7e13c3a9e}{write\+Value\+Directly}} (\mbox{\hyperlink{classPtr}{Ptr}} ptr, const \mbox{\hyperlink{classValue}{Value}} \&value)
\begin{DoxyCompactList}\small\item\em Write a \mbox{\hyperlink{classValue}{Value}} directly to disk storage. Used when \mbox{\hyperlink{classCacheMap}{Cache\+Map}} entry is hit. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classShard_ad8fd5e8b49213a66affc2bc8ffaeadab}{increment\+Alive\+Values\+Cnt}} () noexcept
\begin{DoxyCompactList}\small\item\em Increase the counter of non-\/deleted elements in this shard. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classShard_a986026ea972175ef7d174cdf0c7ea631}{decrement\+Alive\+Values\+Cnt}} () noexcept
\begin{DoxyCompactList}\small\item\em Decrease the counter of non-\/deleted elements in this shard. \end{DoxyCompactList}\item 
boolean \mbox{\hyperlink{classShard_a7dcb8c5e3e998662dc0659efb978c405}{is\+Rebuild\+Required}} () const noexcept
\begin{DoxyCompactList}\small\item\em Check if a rebuild needs to be called. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Static Public Member Functions}
\begin{DoxyCompactItemize}
\item 
static size\+\_\+t \mbox{\hyperlink{classShard_a939e90e4cdd274cc1d8fa202912f0f4f}{get\+Shard\+Index}} (\mbox{\hyperlink{classKey}{Key}} key) noexcept
\begin{DoxyCompactList}\small\item\em Get the shard index that contains the \mbox{\hyperlink{classKey}{Key}}. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Private Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{classShard_ad20ff309054d160c0a3d208dd0939b48}{Shard}} (size\+\_\+t \mbox{\hyperlink{classShard_abefece21372068eb7596f90990b71f2d}{index}}) noexcept
\item 
\mbox{\hyperlink{classShard_acc02dc4ac1c7bb22911653ab3c7c5690}{Shard}} (size\+\_\+t \mbox{\hyperlink{classShard_abefece21372068eb7596f90990b71f2d}{index}}, const std\+::vector$<$ \mbox{\hyperlink{structEntry}{Entry}} $>$ \&storage\+Hash\+Table\+Entries) noexcept
\end{DoxyCompactItemize}
\doxysubsection*{Private Attributes}
\begin{DoxyCompactItemize}
\item 
size\+\_\+t \mbox{\hyperlink{classShard_abefece21372068eb7596f90990b71f2d}{index}}
\begin{DoxyCompactList}\small\item\em \mbox{\hyperlink{classShard}{Shard}} index. \end{DoxyCompactList}\item 
size\+\_\+t \mbox{\hyperlink{classShard_add9303ccc9ebed081e0d4e2f9ea405a3}{alive\+Values\+Cnt}}
\begin{DoxyCompactList}\small\item\em Number of values that are stored on disk, but not deleted yet. \end{DoxyCompactList}\item 
\mbox{\hyperlink{classBloomFilter}{Bloom\+Filter}}$<$ \mbox{\hyperlink{classKey}{Key}} $>$ \mbox{\hyperlink{classShard_a3b161f4b5028fe56c148424358c9bbb6}{filter}}
\begin{DoxyCompactList}\small\item\em A filter. \end{DoxyCompactList}\item 
friend \mbox{\hyperlink{classShard_ab1baae30177bbbcdeb93f7521bc841fd}{Shard\+Builder}}
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
A single part of \mbox{\hyperlink{classKVS}{KVS}} after sharding. 

\doxysubsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{classShard_ad1d1e143159f59129d23f642c796477f}\label{classShard_ad1d1e143159f59129d23f642c796477f}} 
\index{Shard@{Shard}!Shard@{Shard}}
\index{Shard@{Shard}!Shard@{Shard}}
\doxysubsubsection{\texorpdfstring{Shard()}{Shard()}\hspace{0.1cm}{\footnotesize\ttfamily [1/3]}}
{\footnotesize\ttfamily Shard\+::\+Shard (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [delete]}}

\mbox{\Hypertarget{classShard_ad20ff309054d160c0a3d208dd0939b48}\label{classShard_ad20ff309054d160c0a3d208dd0939b48}} 
\index{Shard@{Shard}!Shard@{Shard}}
\index{Shard@{Shard}!Shard@{Shard}}
\doxysubsubsection{\texorpdfstring{Shard()}{Shard()}\hspace{0.1cm}{\footnotesize\ttfamily [2/3]}}
{\footnotesize\ttfamily Shard\+::\+Shard (\begin{DoxyParamCaption}\item[{size\+\_\+t}]{index }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [explicit]}, {\ttfamily [private]}, {\ttfamily [noexcept]}}

\mbox{\Hypertarget{classShard_acc02dc4ac1c7bb22911653ab3c7c5690}\label{classShard_acc02dc4ac1c7bb22911653ab3c7c5690}} 
\index{Shard@{Shard}!Shard@{Shard}}
\index{Shard@{Shard}!Shard@{Shard}}
\doxysubsubsection{\texorpdfstring{Shard()}{Shard()}\hspace{0.1cm}{\footnotesize\ttfamily [3/3]}}
{\footnotesize\ttfamily Shard\+::\+Shard (\begin{DoxyParamCaption}\item[{size\+\_\+t}]{index,  }\item[{const std\+::vector$<$ \mbox{\hyperlink{structEntry}{Entry}} $>$ \&}]{storage\+Hash\+Table\+Entries }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [explicit]}, {\ttfamily [private]}, {\ttfamily [noexcept]}}



\doxysubsection{Member Function Documentation}
\mbox{\Hypertarget{classShard_a986026ea972175ef7d174cdf0c7ea631}\label{classShard_a986026ea972175ef7d174cdf0c7ea631}} 
\index{Shard@{Shard}!decrementAliveValuesCnt@{decrementAliveValuesCnt}}
\index{decrementAliveValuesCnt@{decrementAliveValuesCnt}!Shard@{Shard}}
\doxysubsubsection{\texorpdfstring{decrementAliveValuesCnt()}{decrementAliveValuesCnt()}}
{\footnotesize\ttfamily void Shard\+::decrement\+Alive\+Values\+Cnt (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [noexcept]}}



Decrease the counter of non-\/deleted elements in this shard. 

Used by \mbox{\hyperlink{classKVS}{KVS}} when an entry in \mbox{\hyperlink{classCacheMap}{Cache\+Map}} is marked as deleted. \mbox{\Hypertarget{classShard_a939e90e4cdd274cc1d8fa202912f0f4f}\label{classShard_a939e90e4cdd274cc1d8fa202912f0f4f}} 
\index{Shard@{Shard}!getShardIndex@{getShardIndex}}
\index{getShardIndex@{getShardIndex}!Shard@{Shard}}
\doxysubsubsection{\texorpdfstring{getShardIndex()}{getShardIndex()}}
{\footnotesize\ttfamily static size\+\_\+t Shard\+::get\+Shard\+Index (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classKey}{Key}}}]{key }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}, {\ttfamily [noexcept]}}



Get the shard index that contains the \mbox{\hyperlink{classKey}{Key}}. 


\begin{DoxyParams}{Parameters}
{\em key} & \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\mbox{\hyperlink{classShard}{Shard}} index. 
\end{DoxyReturn}
\mbox{\Hypertarget{classShard_ad8fd5e8b49213a66affc2bc8ffaeadab}\label{classShard_ad8fd5e8b49213a66affc2bc8ffaeadab}} 
\index{Shard@{Shard}!incrementAliveValuesCnt@{incrementAliveValuesCnt}}
\index{incrementAliveValuesCnt@{incrementAliveValuesCnt}!Shard@{Shard}}
\doxysubsubsection{\texorpdfstring{incrementAliveValuesCnt()}{incrementAliveValuesCnt()}}
{\footnotesize\ttfamily void Shard\+::increment\+Alive\+Values\+Cnt (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [noexcept]}}



Increase the counter of non-\/deleted elements in this shard. 

Used by \mbox{\hyperlink{classKVS}{KVS}} when a deleted element in \mbox{\hyperlink{classCacheMap}{Cache\+Map}} is added again. \mbox{\Hypertarget{classShard_a7dcb8c5e3e998662dc0659efb978c405}\label{classShard_a7dcb8c5e3e998662dc0659efb978c405}} 
\index{Shard@{Shard}!isRebuildRequired@{isRebuildRequired}}
\index{isRebuildRequired@{isRebuildRequired}!Shard@{Shard}}
\doxysubsubsection{\texorpdfstring{isRebuildRequired()}{isRebuildRequired()}}
{\footnotesize\ttfamily boolean Shard\+::is\+Rebuild\+Required (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [noexcept]}}



Check if a rebuild needs to be called. 

\begin{DoxyReturn}{Returns}
boolean 
\end{DoxyReturn}
\mbox{\Hypertarget{classShard_ae06a68baa373b1dc5d006c50ffc3f935}\label{classShard_ae06a68baa373b1dc5d006c50ffc3f935}} 
\index{Shard@{Shard}!readValue@{readValue}}
\index{readValue@{readValue}!Shard@{Shard}}
\doxysubsubsection{\texorpdfstring{readValue()}{readValue()}}
{\footnotesize\ttfamily std\+::pair$<$\mbox{\hyperlink{structEntry}{Entry}}, std\+::optional$<$\mbox{\hyperlink{classValue}{Value}}$>$ $>$ Shard\+::read\+Value (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classKey}{Key}}}]{key }\end{DoxyParamCaption}) const}



Read a value from this shard. 


\begin{DoxyParams}{Parameters}
{\em key} & \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\mbox{\hyperlink{structEntry}{Entry}} that corresponds to given \mbox{\hyperlink{classKey}{Key}} 
\end{DoxyReturn}
\mbox{\Hypertarget{classShard_a0c5ba849d919ae276ff2b2985e582e1a}\label{classShard_a0c5ba849d919ae276ff2b2985e582e1a}} 
\index{Shard@{Shard}!readValueDirectly@{readValueDirectly}}
\index{readValueDirectly@{readValueDirectly}!Shard@{Shard}}
\doxysubsubsection{\texorpdfstring{readValueDirectly()}{readValueDirectly()}}
{\footnotesize\ttfamily \mbox{\hyperlink{classValue}{Value}} Shard\+::read\+Value\+Directly (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classPtr}{Ptr}}}]{ptr }\end{DoxyParamCaption}) const}



Read a value directly from disk storage. Used when \mbox{\hyperlink{classCacheMap}{Cache\+Map}} entry is hit. 

Attention\+: this nethod does not update the internal alive values counter, it has to be done using the increment / decrement methods.


\begin{DoxyParams}{Parameters}
{\em ptr} & \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}

\end{DoxyReturn}
\mbox{\Hypertarget{classShard_ac1f0ae87249f0d74361de03226940a14}\label{classShard_ac1f0ae87249f0d74361de03226940a14}} 
\index{Shard@{Shard}!removeEntry@{removeEntry}}
\index{removeEntry@{removeEntry}!Shard@{Shard}}
\doxysubsubsection{\texorpdfstring{removeEntry()}{removeEntry()}}
{\footnotesize\ttfamily \mbox{\hyperlink{structEntry}{Entry}} Shard\+::remove\+Entry (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classKey}{Key}}}]{key }\end{DoxyParamCaption})}



Remove a value from this shard. 

Can also handle delayed removals.


\begin{DoxyParams}{Parameters}
{\em key} & \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\mbox{\hyperlink{structEntry}{Entry}} that corresponds to given \mbox{\hyperlink{classKey}{Key}} 
\end{DoxyReturn}
\mbox{\Hypertarget{classShard_a1d553b3945c59a9eea2404c170debb77}\label{classShard_a1d553b3945c59a9eea2404c170debb77}} 
\index{Shard@{Shard}!writeValue@{writeValue}}
\index{writeValue@{writeValue}!Shard@{Shard}}
\doxysubsubsection{\texorpdfstring{writeValue()}{writeValue()}}
{\footnotesize\ttfamily \mbox{\hyperlink{structEntry}{Entry}} Shard\+::write\+Value (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classKey}{Key}}}]{key,  }\item[{const \mbox{\hyperlink{classValue}{Value}} \&}]{value }\end{DoxyParamCaption})}



Write a value to this shard. 


\begin{DoxyParams}{Parameters}
{\em key} & \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
either the old or new \mbox{\hyperlink{structEntry}{Entry}} that corresponds to given \mbox{\hyperlink{classKey}{Key}} 
\end{DoxyReturn}
\mbox{\Hypertarget{classShard_a0037fc14121a68f2320549d7e13c3a9e}\label{classShard_a0037fc14121a68f2320549d7e13c3a9e}} 
\index{Shard@{Shard}!writeValueDirectly@{writeValueDirectly}}
\index{writeValueDirectly@{writeValueDirectly}!Shard@{Shard}}
\doxysubsubsection{\texorpdfstring{writeValueDirectly()}{writeValueDirectly()}}
{\footnotesize\ttfamily void Shard\+::write\+Value\+Directly (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classPtr}{Ptr}}}]{ptr,  }\item[{const \mbox{\hyperlink{classValue}{Value}} \&}]{value }\end{DoxyParamCaption})}



Write a \mbox{\hyperlink{classValue}{Value}} directly to disk storage. Used when \mbox{\hyperlink{classCacheMap}{Cache\+Map}} entry is hit. 

Attention\+: this nethod does not update the internal alive values counter, it has to be done using the increment / decrement methods.


\begin{DoxyParams}{Parameters}
{\em ptr} & \\
\hline
{\em value} & \\
\hline
\end{DoxyParams}


\doxysubsection{Member Data Documentation}
\mbox{\Hypertarget{classShard_add9303ccc9ebed081e0d4e2f9ea405a3}\label{classShard_add9303ccc9ebed081e0d4e2f9ea405a3}} 
\index{Shard@{Shard}!aliveValuesCnt@{aliveValuesCnt}}
\index{aliveValuesCnt@{aliveValuesCnt}!Shard@{Shard}}
\doxysubsubsection{\texorpdfstring{aliveValuesCnt}{aliveValuesCnt}}
{\footnotesize\ttfamily size\+\_\+t Shard\+::alive\+Values\+Cnt\hspace{0.3cm}{\ttfamily [private]}}



Number of values that are stored on disk, but not deleted yet. 

\mbox{\Hypertarget{classShard_a3b161f4b5028fe56c148424358c9bbb6}\label{classShard_a3b161f4b5028fe56c148424358c9bbb6}} 
\index{Shard@{Shard}!filter@{filter}}
\index{filter@{filter}!Shard@{Shard}}
\doxysubsubsection{\texorpdfstring{filter}{filter}}
{\footnotesize\ttfamily \mbox{\hyperlink{classBloomFilter}{Bloom\+Filter}}$<$\mbox{\hyperlink{classKey}{Key}}$>$ Shard\+::filter\hspace{0.3cm}{\ttfamily [private]}}



A filter. 

\mbox{\Hypertarget{classShard_abefece21372068eb7596f90990b71f2d}\label{classShard_abefece21372068eb7596f90990b71f2d}} 
\index{Shard@{Shard}!index@{index}}
\index{index@{index}!Shard@{Shard}}
\doxysubsubsection{\texorpdfstring{index}{index}}
{\footnotesize\ttfamily size\+\_\+t Shard\+::index\hspace{0.3cm}{\ttfamily [private]}}



\mbox{\hyperlink{classShard}{Shard}} index. 

\mbox{\Hypertarget{classShard_ab1baae30177bbbcdeb93f7521bc841fd}\label{classShard_ab1baae30177bbbcdeb93f7521bc841fd}} 
\index{Shard@{Shard}!ShardBuilder@{ShardBuilder}}
\index{ShardBuilder@{ShardBuilder}!Shard@{Shard}}
\doxysubsubsection{\texorpdfstring{ShardBuilder}{ShardBuilder}}
{\footnotesize\ttfamily friend Shard\+::\+Shard\+Builder\hspace{0.3cm}{\ttfamily [private]}}



The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
include/\mbox{\hyperlink{Shard_8h}{Shard.\+h}}\end{DoxyCompactItemize}
